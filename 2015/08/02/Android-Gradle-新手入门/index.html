<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Android Gradle 新手入门 · Keep a curiosity</title><meta name="description" content="Android Gradle 新手入门 - dpt"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.dptdev.com/atom.xml" title="Keep a curiosity"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Android Gradle 新手入门</h1><div class="post-info">Aug 2, 2015</div><div class="post-content"><h2 id="什么是Gradle？">什么是Gradle？</h2><p>Gradle 是一个基于Ant和Maven概念的项目自动化建构工具。</p>
<h2 id="Gradle_基本概念">Gradle 基本概念</h2><p>下图是很基本的Android Gradle工程，目录结构也是正常的Gradle工程的样式。<a href="https://github.com/dupengtao/StudyGradle" target="_blank" rel="external">Demo地址</a></p>
<p><img src="http://7d9pic.com1.z0.glb.clouddn.com/gradle新手上路4.png" alt="Gradle基本工程图"></p>
<h3 id="StudyGradle/build-gradle(图标1)"><strong>StudyGradle/build.gradle(图标1)</strong></h3><p>这个文件是整个项目的gradle基础配置文件:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></span><br><span class="line"></span><br><span class="line">buildscript &#123; <span class="comment">// 脚步运行环境</span></span><br><span class="line">    repositories &#123;<span class="comment">// 用于项目依赖</span></span><br><span class="line">        <span class="comment">// 中央远程仓库</span></span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        <span class="comment">// gradle版本</span></span><br><span class="line">        classpath <span class="string">'com.android.tools.build:gradle:1.2.3'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">NOTE</span></span>: Do not place your application dependencies here; they belong</span></span><br><span class="line">        <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里主要描述了两个方面：</p>
<ol>
<li>gradle 版本</li>
<li>仓库的源地址</li>
</ol>
<h3 id="StudyGradle/app/build-gradle(图标2)"><strong>StudyGradle/app/build.gradle(图标2)</strong></h3><p>这个文件是Module名称为app的gradle的配置文件，在此项目中是主要的gradle配置文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明插件类型，这里声明的是Android程序</span></span><br><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">//编译SDK的版本</span></span><br><span class="line">    compileSdkVersion <span class="number">22</span></span><br><span class="line">    <span class="comment">//build tools 的版本 对应Android SDK Build-tools</span></span><br><span class="line">    buildToolsVersion <span class="string">"21.1.2"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        <span class="comment">//应用包名</span></span><br><span class="line">        applicationId <span class="string">"com.example.dpt.studygradledemo"</span></span><br><span class="line">        minSdkVersion <span class="number">21</span></span><br><span class="line">        targetSdkVersion <span class="number">22</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;<span class="comment">//构建类型，常用的有release和debug两种，可以在这里面启用混淆，启用zipAlign以及配置签名信息等</span></span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="comment">//是否进行混淆</span></span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            <span class="comment">//混淆文件位置</span></span><br><span class="line">            <span class="function">proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>, 'proguard-rules.pro'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除lint检查的error</span></span><br><span class="line">    lintOptions </span>&#123;</span><br><span class="line">        abortOnError <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// 编译依赖libs目录下的所有jar包</span></span><br><span class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span><br><span class="line">    <span class="comment">// //应用格式: packageName:artifactId:version</span></span><br><span class="line">    <span class="comment">// 依赖 support-v4</span></span><br><span class="line">    compile 'com.android.support:support-v4:22.2.0'</span><br><span class="line">    <span class="comment">// 依赖 card view</span></span><br><span class="line">    compile 'com.android.support:cardview-v7:22.2.0'</span><br><span class="line">    <span class="comment">// 依赖 library module</span></span><br><span class="line">    compile <span class="title">project</span><span class="params">(<span class="string">':demolibrary'</span>)</span></span><br><span class="line">    compile 'com.android.support:palette-v7:22.2.0'</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ps:</p>
<ol>
<li>开头第一行apply plugin: ‘com.android.application’，这表示该module是一个app module，应用了com.android.application插件，如果是一个android library，那么这里的是apply plugin: ‘com.android.library’。’com.android.application’是较新的写法，但不是最新的写法。</li>
<li>buildToolsVersion 对应Android SDK Build-tools的版本，如图<br><img src="http://7d9pic.com1.z0.glb.clouddn.com/gradle新手上路5.png" alt="Android SDK Build-tools"><br><br></li>
</ol>
<h4 id="buildTypes{}"><strong>buildTypes{}</strong></h4><p>buildTypes是构建类型，常用的有release和debug两种，可以在这里面启用混淆，启用zipAlign以及配置签名信息等。<br><br></p>
<h4 id="defaultConfig{}"><strong>defaultConfig{}</strong></h4><p>这里描述的是一些项目基础默认配置</p>
<p>常用的属性有：versionCode,versionName,minSdkVersion,targetSdkVersion,applicationId等<br><br></p>
<h4 id="dependencies{}"><strong>dependencies{}</strong></h4><p>dependencies就不属于Android专有的配置了，它定义了该module需要依赖的jar，aar，jcenter库信息。</p>
<ol>
<li>compile fileTree(dir: ‘libs’, include: [‘*.jar’]) 编译依赖libs目录下的所有jar包</li>
<li>compile ‘com.android.support:support-v4:22.2.0’ 依赖 support-v4 </li>
<li>compile project(‘:demolibrary’) 依赖其他module</li>
</ol>
<p>ps:</p>
<p>其中依赖开源组件的格式为：packageName:artifactId:version 例如，compile ‘com.android.support:support-v4:22.2.0’</p>
<h3 id="StudyGradle/demolibrary/build-gradle(图标2)"><strong>StudyGradle/demolibrary/build.gradle(图标2)</strong></h3><p>这个是一个依赖库的module配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明Android library</span></span><br><span class="line">apply plugin: <span class="string">'com.android.library'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">//编译SDK版本</span></span><br><span class="line">    compileSdkVersion <span class="number">22</span></span><br><span class="line">    <span class="comment">//build tools 的版本 对应Android SDK Build-tools</span></span><br><span class="line">    buildToolsVersion <span class="string">"21.1.2"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion <span class="number">21</span></span><br><span class="line">        targetSdkVersion <span class="number">22</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="function">minifyEnabled <span class="keyword">false</span></span><br><span class="line">            proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>, 'proguard-rules.pro'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies </span>&#123;</span><br><span class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ps:</p>
<ol>
<li>这里需要注意的是apply plugin 这里声明为Android library</li>
</ol>
<h3 id="StudyGradle/build-gradle(图标3)"><strong>StudyGradle/build.gradle(图标3)</strong></h3><p>这个文件是全局的项目配置文件，里面主要声明一些需要加入gradle的module</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">':app'</span>, <span class="string">':demolibrary'</span></span><br></pre></td></tr></table></figure>
<h3 id="Gradle_Wrapper(图标4)"><strong>Gradle Wrapper(图标4)</strong></h3><p>android studio希望你能在电脑上不安装gradle的情况下，依然使用gradle管理android项目，因此通过AS创建的每个项目都会内嵌一个gradle wrapper，作用是检查你当前的共工作环境是否安装了创建本项目时所用的gradle版本。<br>如果没有，它会自动下载相应的gradle放在~/.gradle/wrapper.目录下。这样当你在你的项目里使用gradle时，可以通过gradlw命令使用当前项目环境的gradle版本，而不受环境变量的影响。</p>
<p>很多人会遇到一个项目build很久，很大一部分原因就是因为这个，他会去下载自带的gradle wrapper，50多M，大部分情况下需要翻墙</p>
<p>如果不能翻墙，也可以更改<strong>gradle-wrapper.properties</strong>的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">distributionBase=GRADLE_USER_HOME</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists</span><br><span class="line">distributionUrl=https\:<span class="comment">//services.gradle.org/distributions/gradle-2.2.1-all.zip</span></span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/08/03/infer-初次使用/" class="prev">上一篇</a><a href="/2015/06/13/Android旋转动画的三种方式/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://www.dptdev.com">dpt</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>