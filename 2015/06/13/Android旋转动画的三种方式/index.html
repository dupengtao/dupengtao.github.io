<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Android旋转动画的三种方式 · Keep a curiosity</title><meta name="description" content="Android旋转动画的三种方式 - dpt"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.dptdev.com/atom.xml" title="Keep a curiosity"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Android旋转动画的三种方式</h1><div class="post-info">Jun 13, 2015</div><div class="post-content"><h2 id="属性动画（系统属性、硬件加速）">属性动画（系统属性、硬件加速）</h2><p>这种方式是直接利用View的setRotation(float rotation)来控制整个view旋转。<a href="http://developer.android.com/guide/topics/graphics/hardware-accel.html" target="_blank" rel="external">关于硬件加速</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">     * Sets the degrees that the view is rotated around the pivot point. Increasing values</span><br><span class="line">     * result in clockwise rotation.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> rotation The degrees of rotation.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@see</span> #getRotation()</span><br><span class="line">     * <span class="doctag">@see</span> #getPivotX()</span><br><span class="line">     * <span class="doctag">@see</span> #getPivotY()</span><br><span class="line">     * <span class="doctag">@see</span> #setRotationX(float)</span><br><span class="line">     * <span class="doctag">@see</span> #setRotationY(float)</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@attr</span> ref android.R.styleable#View_rotation</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRotation</span><span class="params">(<span class="keyword">float</span> rotation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rotation != getRotation()) &#123;</span><br><span class="line">            <span class="comment">// Double-invalidation is necessary to capture view's old and new areas</span></span><br><span class="line">            invalidateViewProperty(<span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">            mRenderNode.setRotation(rotation);</span><br><span class="line">            invalidateViewProperty(<span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">            invalidateParentIfNeededAndWasQuickRejected();</span><br><span class="line">            notifySubtreeAccessibilityStateChangedIfNeeded();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>动画:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ObjectAnimator <span class="title">preRotateAnim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PropertyValuesHolder rotation = PropertyValuesHolder.ofFloat(<span class="string">"rotation"</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">360</span>);</span><br><span class="line">    ObjectAnimator rotateAnim = ObjectAnimator.ofPropertyValuesHolder(<span class="keyword">this</span>, rotation).setDuration(ROTATE_DURATION);</span><br><span class="line">    rotateAnim.setRepeatCount(-<span class="number">1</span>); <span class="comment">// -1:Infinite loop</span></span><br><span class="line">    rotateAnim.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</span><br><span class="line">    <span class="keyword">return</span> rotateAnim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="属性动画（自定义属性）">属性动画（自定义属性）</h2><p>这里自定义了rot属性，用来控制canvas的旋转</p>
<p>动画:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ObjectAnimator <span class="title">preRotateAnim2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PropertyValuesHolder rotation = PropertyValuesHolder.ofFloat(<span class="string">"rot"</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">360</span>);</span><br><span class="line">    ObjectAnimator rotateAnim = ObjectAnimator.ofPropertyValuesHolder(<span class="keyword">this</span>, rotation).setDuration(ROTATE_DURATION);</span><br><span class="line">    rotateAnim.setRepeatCount(-<span class="number">1</span>); <span class="comment">// -1:Infinite loop</span></span><br><span class="line">    rotateAnim.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</span><br><span class="line">    rotateAnim.addUpdateListener(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> rotateAnim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">     <span class="keyword">if</span> (rotateAnim.isRunning()) &#123;</span><br><span class="line">         canvas.rotate(rot, canvas.getWidth() / <span class="number">2</span>, canvas.getHeight() / <span class="number">2</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Tween动画">Tween动画</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> RotateAnimation <span class="title">preRotateAnim2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RotateAnimation anim = <span class="keyword">new</span> RotateAnimation(<span class="number">0</span>, <span class="number">360</span>,</span><br><span class="line">                Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>, Animation.RELATIVE_TO_SELF,</span><br><span class="line">                <span class="number">0.5f</span>);</span><br><span class="line">        anim.setDuration(<span class="number">1000</span>);</span><br><span class="line">        anim.setRepeatCount(-<span class="number">1</span>);</span><br><span class="line">        anim.setRepeatMode(Animation.INFINITE);</span><br><span class="line">        anim.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</span><br><span class="line">        <span class="keyword">return</span> anim;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="性能对比">性能对比</h2><p>测试环境相同，乐视pro1，高通810芯片，非原生rom，也可以下载我的demo，在自己的手机上试试，实测mtk的芯片更消耗cpu</p>
<ul>
<li>属性动画－硬件加速</li>
</ul>
<p><img src="http://7d9pic.com1.z0.glb.clouddn.com/属性动画硬件加速.png" alt="属性动画－硬件加速"></p>
<ul>
<li>属性动画</li>
</ul>
<p><img src="http://7d9pic.com1.z0.glb.clouddn.com/属性动画.png" alt="属性动画"></p>
<ul>
<li>Tween动画</li>
</ul>
<p><img src="http://7d9pic.com1.z0.glb.clouddn.com/补间动画.png" alt="Tween动画"></p>
<p><a href="https://github.com/dupengtao/RotateAnimationDemos" target="_blank" rel="external">Demo地址</a></p>
<blockquote>
<p>疑问：为什么硬件加速会更消耗cpu资源？</p>
</blockquote>
<p><br></p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/08/02/Android-Gradle-新手入门/" class="prev">上一篇</a><a href="/2015/05/30/Mac下进行Android源码开发的一种解决方法/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://www.dptdev.com">dpt</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>